<html>
<body>
  

<!-- Bouton pour démarrer l'enregistrement -->
<button onclick="startRecording()">Start Recording</button>

<!-- Bouton pour arrêter l'enregistrement -->
<button onclick="stopRecording()">Stop Recording</button>

<!-- Élément audio pour jouer le son enregistré -->
<audio id="recordedAudio"></audio>

<script>
  // Fonction pour démarrer l'enregistrement
  function startRecording() {
    // Vérifie si l'enregistrement est pris en charge par le navigateur
    if (navigator.mediaDevices.getUserMedia) {
      console.log('Enregistrement pris en charge');
      
      // Demande l'autorisation d'accéder au micro
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(function (stream) {
          // Crée un enregistreur audio
          var audioRecorder = new MediaRecorder(stream);

          // Démarre l'enregistrement
          audioRecorder.start();

          // Enregistre le flux audio dans un fichier audio
          var audioChunks = [];
          audioRecorder.addEventListener("dataavailable", function (event) {
            audioChunks.push(event.data);
          });

          // Arrête l'enregistrement et crée un fichier audio lorsque l'enregistrement est terminé
          audioRecorder.addEventListener("stop", function () {
            var audioBlob = new Blob(audioChunks);
            var audioUrl = URL.createObjectURL(audioBlob);
            var audio = document.getElementById('recordedAudio');
            audio.src = audioUrl;
            audio.controls = true;
            audio.autoplay = true;
          });

          // Stocke l'enregistreur audio dans une variable globale pour pouvoir l'arrêter plus tard
          window.audioRecorder = audioRecorder;
        })
        .catch(function (err) {
          console.log('Erreur lors de l\'accès au micro : ', err);
        });
    } else {
      console.log('Enregistrement non pris en charge par le navigateur');
    }
  }

  // Fonction pour arrêter l'enregistrement
  function stopRecording() {
    // Vérifie si l'enregistreur audio est défini
    if (window.audioRecorder) {
      // Arrête l'enregistrement
      window.audioRecorder.stop();
      window.audioRecorder = null;
    }
  }
</script>

</body>
</html>


<!DOCTYPE html>
<html>
  <head>
    <title>Microphone Example</title>
  </head>
  <body>
    <h1>Microphone Example</h1>
    <canvas id="waveform"></canvas>
    <script>
      navigator.mediaDevices.getUserMedia({ audio: true, video: false })
        .then(function(stream) {
          var audioCtx = new AudioContext();
          var analyser = audioCtx.createAnalyser();
          var microphone = audioCtx.createMediaStreamSource(stream);
          var canvas = document.querySelector('canvas');
          var canvasCtx = canvas.getContext('2d');

          analyser.fftSize = 2048;
          var bufferLength = analyser.frequencyBinCount;
          var dataArray = new Uint8Array(bufferLength);

          microphone.connect(analyser);
          analyser.connect(audioCtx.destination);

          function draw() {
            requestAnimationFrame(draw);
            analyser.getByteTimeDomainData(dataArray);
            canvasCtx.fillStyle = 'rgb(200, 200, 200)';
            canvasCtx.fillRect(0, 0, canvas.width, canvas.height);
            canvasCtx.lineWidth = 2;
            canvasCtx.strokeStyle = 'rgb(0, 0, 0)';
            canvasCtx.beginPath();
            var sliceWidth = canvas.width * 1.0 / bufferLength;
            var x = 0;
            for(var i = 0; i < bufferLength; i++) {
              var v = dataArray[i] / 128.0;
              var y = v * canvas.height/2;
              if(i === 0) {
                canvasCtx.moveTo(x, y);
              } else {
                canvasCtx.lineTo(x, y);
              }
              x += sliceWidth;
            }
            canvasCtx.lineTo(canvas.width, canvas.height/2);
            canvasCtx.stroke();
          }
          draw();
        })
        .catch(function(error) {
          console.log(error);
        });
    </script>
  </body>
</html>